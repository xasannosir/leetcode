SELECT u.product_id AS product_id, (CASE WHEN e.price IS NOT NULL THEN e.price ELSE 10 END) AS price FROM (SELECT DISTINCT product_id FROM Products) AS u LEFT JOIN (SELECT m.product_id AS product_id, p.new_price AS price FROM Products AS p INNER JOIN (SELECT product_id, MAX(change_date) AS max_date FROM Products WHERE change_date <= '2019-08-16' GROUP BY product_id) AS m ON m.product_id = p.product_id AND p.change_date = m.max_date) AS e ON u.product_id = e.product_id